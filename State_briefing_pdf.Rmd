--- 
title: "`r paste0('ANS performance briefing - ', State_curr)`"
author: "EUROCONTROL Performance Review Unit"
date: "`r format(Sys.Date(), '%d/%b/%Y')`"
site: bookdown::bookdown_site
output:
  bookdown::pdf_document2:
    highlight: tango
    toc: FALSE
documentclass: book
bibliography: "bibliography.bib"
link-citations: yes
colorlinks: yes
monofont: "Source Code Pro"
monofontoptions: "Scale=0.7"
cover-image: images/logo.png
---

```{r setup, echo=FALSE, include=FALSE}

library(dplyr)
library(ggplot2)
library(viridis)
library(lubridate)
library(scales)
library(ectrlplot)
library(tidyquant)

# run setup script
source("_common.R")

options(tinytex.verbose = TRUE)

knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, error=FALSE, out.width = "\\textwidth")
```



# Preface {-}

```{r ECTL-logo, fig.align='center', echo=FALSE, include=identical(knitr:::pandoc_to(), 'html')}
knitr::include_graphics('images/logo.png', dpi = NA)
```

This performance briefing has been prepared by the EUROCONTROL Performance Review Unit (PRU) in the interest of the exchange of information.

If you have any questions related to this document or if we can help with any ANS performance related matter, then please do not hesitate to contact us: <pru-support@eurocontrol.int>

The information may be copied in whole or in part providing that the copyright notice and disclaimer are included.

The views expressed herein do not necessarily reflect the official views or policy of EUROCONTROL, which makes no warranty, either implied or express, for the information contained in this document, neither does it assume any legal liability or responsibility for the accuracy, completeness or usefulness of this information.

## Key observations {-}

### TRAFFIC {-}

- Following the high traffic increase already in 2017 ..

- The strong growth ..

- As a result ..

### SAFETY {-}

- No data available

### CAPACITY {-}

#### En-route ATFM delays {-}

- No en-route ATFM delay..

#### Airport arrival ATFM delays {-}

- No airport arrival ATFM delay..

### ENVIRONMENT {-}

#### Horizontal en-route flight efficiency {-}

- In 2008, Finland..

#### Vertical en-route flight efficiency {-}



#### Vertical flight efficiency during climb and descent {-}



### COST-EFFECTIVENESS {-}

- ARMATS represents.. see [@pru:ace-report-2015]

- Since ARMATS did not..

- Compared to the..



```{=latex}
% Trigger ToC creation in LaTeX
\tableofcontents
```



```{=latex}
\listoffigures
```



# Institutional arrangements


# Traffic characteristics


# Safety


# Capacity

```{r enr-setup, echo = FALSE, message = FALSE, warning=FALSE}

# En-route ATFM delay

state_under_review <- "NATS"

# choose a date =>
year_start <- "2015-01-01"
# choose a date <=
year_end <- "2019-01-31"

# year of the average en route ATFM delay per flight (ECTL area)
year_input <- "2018"
# reference year 
ref_year <- "2017"

# Airport arrival ATFM delays

airport <- "Bergen"
since <- "2014"
to <- "2019"

# Read data

source("R/capacity/read-ert-dly.R")
source("R/capacity/read-apt-dly.R")

```


## Air traffic flow management (ATFM) delays

Source : NM, PRU ANS Performance Data Portal  
         The data in this section is from the PRU ANS performance data portal (data section).  
         It is available at: <http://ansperformance.eu/data/performancearea/>

### En-route ATFM delays

```{r enr-flights, echo=FALSE, fig.cap="Flights", fig.align='center'}

source("R/capacity/plot-flights.R")
flights_function(year_start, year_end, state_under_review)

```



```{r enr-delay, fig.cap="En-route ATFM delay"}

source("R/capacity/plot-delays.R")
delays(year_start, year_end, state_under_review)

```



```{r enr-avg-dly-flt, fig.cap="Average en-route ATFM delay per flight"}

source("R/capacity/plot-avg-dly-flt.R")
avg_delay_flight(year_start, year_end, state_under_review)

```



```{r enr-average-delay-grouped, fig.cap='Average en route ATFM delay per flight (EUROCONTROL area)'}

source("R/capacity/plot-avg-grouped-dly-flt.R")
avg_delay_grouped(year_input, ref_year)

```

### Airport arrival ATFM delays

(ref:avg-arriv-delay) Airport arrival ATFM delays (`r airport`). 

```{r apt-avg-arriv-delay, fig.cap='(ref:avg-arriv-delay)'}

source("R/capacity/plot-avg-arr-dly.R")
apt_arrival_dly(airport, since, to)

```

(ref:avg-daily-arr) Airport arrival ATFM delays (`r airport`). 

```{r apt-avg-daily-arr, fig.cap='(ref:avg-daily-arr)'}

source("R/capacity/plot-avg-daily-arr.R")
avg_daily_arrivals(airport, since, to)

```



# Environment

```{r env-setup, echo = FALSE, message = FALSE, warning=FALSE}

# Horizontal flight efficieny
# year for hfe
year_input <- "2018"
year_input_start <- "2014"

# type of trajectory 
model <- "CPF"

# state
state_under_review <- "Sweden"

# choose a start date =>
year_start <- "2014-01-01"
# choose an end date <=
year_end <- "2018-12-31"

# Read data

source("R/environment/read-hfe.R")

```


Source : PRU ANS Performance Data Portal 
         The data in this section is from the PRU ANS performance data portal (data section).  
         It is available at: <http://ansperformance.eu/data/performancearea/>

## Horizontal flight efficiency

(ref:hfe-year) Horizontal en-route flight efficiency - (`r state_under_review`). 

```{r hfe-year, fig.cap='(ref:hfe-year)'}

source("R/environment/plot-hfe-year.R")
hfe_year(year_input_start, year_input, state_under_review)

```

(ref:hfe-daily) Horizontal en-route flight efficiency - (`r state_under_review`). 

```{r hfe-daily, fig.cap='(ref:hfe-daily)'}

source("R/environment/plot-hfe-daily.R")
hfe_daily(year_start, year_end, state_under_review)

```

(ref:flt-eff) Horizontal en-route flight efficiency by State (actual trajectories - `r year_input`). 

```{r hfe-flt-eff, fig.cap='(ref:flt-eff)'}

source("R/environment/plot-flt-efficiency.R")
flt_eff(year_input, model)

```

```{r hfe-values, echo = FALSE, message = FALSE}
value <- all_countries %>%
  filter(type_model == model) %>% 
  filter(entity_name != "Morocco" & entity_name != "Spain (Canarias)" & 
           entity_name != "Spain (Continental)") %>%
  filter(yyyy == year_input) %>% 
  group_by(entity_name, yyyy) %>%
  summarise(flt_efficiency = sum(flt_efficiency)) %>%
  mutate(flt_eff = 100 - flt_efficiency)

avg_ectl <- round(sum(value$flt_eff)/length(value$flt_eff), 1)
avg_ectl <- paste0(avg_ectl, "%")
```

- Horizontal en-route flight efficiency (actual trajectory) was  `r avg_ectl` 
in the EUROCONTROL area in `r year_input`. 

(ref:avg-add) Horizontal en-route flight efficiency by State (actual trajectories - `r year_input`). 

```{r hfe-avg-add, fig.cap='(ref:avg-add)'}

source("R/environment/read-ert-dly-fir.R")
source("R/environment/plot-avg-add-per-flt.R")
avg_add_flt(year_input, model)

```

(ref:tot-share) Horizontal en-route flight efficiency by State (actual trajectories - `r year_input`). 

```{r hfe-tot-share, fig.cap='(ref:tot-share)'}

source("R/environment/plot-total-share.R")
add_total_share(year_input, model)

```

(ref:add-flown) Horizontal en-route flight efficiency by State (actual trajectories - `r year_input`). 

```{r hfe-add-flown, fig.cap='(ref:add-flown)'}

source("R/environment/plot-add-flown.R")
add_flown(year_input, model)

```


# Cost-effectiveness


# Annex 1: Evolution of cost-effectiveness performance (2012-2017)


# Annex 2: Network Operations Plan (2018-2019/22)

## YEREVAN ACC


# References


