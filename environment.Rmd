---
editor_options:
  chunk_output_type: console
output:
  pdf_document: default
  html_document: default
---
```{r echo = FALSE, message = FALSE, warning=FALSE}

library(dplyr)
library(ggplot2)
library(viridis)
library(lubridate)
library(scales)
library(tidyquant)

# run setup script
source("_common.R")

# Horizontal flight efficieny
# year for hfe
year_input <- "2018"
year_input_start <- "2014"

# type of trajectory 
model <- "CPF"

# state
state_under_review <- State

# choose a start date =>
year_start <- "2014-01-01"
# choose an end date <=
year_end <- "2018-12-31"

# Read data

source("R/environment/read-hfe.R")

```


# Environment 

Source : PRU ANS Performance Data Portal 
         The data in this section is from the PRU ANS performance data portal (data section).  
         It is available at: <http://ansperformance.eu/data/performancearea/>

## Horizontal flight efficiency

(ref:hfe-year) Horizontal en-route flight efficiency - (`r state_under_review`). 

```{r hfe-year, fig.cap='(ref:hfe-year)'}

source("R/environment/plot-hfe-year.R")
hfe_year(year_input_start, year_input, state_under_review)

```

(ref:hfe-daily) Horizontal en-route flight efficiency - (`r state_under_review`). 

```{r hfe-daily, fig.cap='(ref:hfe-daily)'}

source("R/environment/plot-hfe-daily.R")
hfe_daily(year_start, year_end, state_under_review)

```

(ref:flt-eff) Horizontal en-route flight efficiency by State (actual trajectories - `r year_input`). 

```{r flt-eff, fig.cap='(ref:flt-eff)'}

source("R/environment/plot-flt-efficiency.R")
flt_eff(year_input, model)

```

```{r echo = FALSE, message = FALSE}
value <- all_countries %>%
  filter(type_model == model) %>% 
  filter(entity_name != "Morocco" & entity_name != "Spain (Canarias)" & 
           entity_name != "Spain (Continental)") %>%
  filter(yyyy == year_input) %>% 
  group_by(entity_name, yyyy) %>%
  summarise(flt_efficiency = sum(flt_efficiency)) %>%
  mutate(flt_eff = 100 - flt_efficiency)

avg_ectl <- round(sum(value$flt_eff)/length(value$flt_eff), 1)
avg_ectl <- paste0(avg_ectl, "%")
```

- Horizontal en-route flight efficiency (actual trajectory) was  `r avg_ectl` 
in the EUROCONTROL area in `r year_input`. 

(ref:avg-add) Horizontal en-route flight efficiency by State (actual trajectories - `r year_input`). 

```{r avg-add, fig.cap='(ref:avg-add)'}

source("R/environment/read-ert-dly-fir.R")
source("R/environment/plot-avg-add-per-flt.R")
avg_add_flt(year_input, model)

```

(ref:tot-share) Horizontal en-route flight efficiency by State (actual trajectories - `r year_input`). 

```{r tot-share, fig.cap='(ref:tot-share)'}

source("R/environment/plot-total-share.R")
add_total_share(year_input, model)

```

(ref:add-flown) Horizontal en-route flight efficiency by State (actual trajectories - `r year_input`). 

```{r add-flown, fig.cap='(ref:add-flown)'}

source("R/environment/plot-add-flown.R")
add_flown(year_input, model)

```
